# Data cleaning



twitterì˜ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¤ì§€ë§Œ ì•„ì§ ì •ë¦¬ê°€ ì•ˆëœ ëŠë‚Œì´ë‹¤.





1. ë°ì´í„°ì˜ í•„ë“œì—ì„œ text ë¶€ë¶„ì˜ mapping ì„ keyword ì—ì„œ textë¡œ ë³€ê²½ í•˜ê¸° 
2. í•„ìš”í•œ ë°ì´í„°ë§Œ ê°€ì§€ê³ ì˜¤ê¸°

### 1. Mapping ì¶”ê°€ ì„¤ì •



ë°ì´í„°ë¥¼ ë°›ì•„ì˜¤ê²Œë˜ë©´ twitterì˜ ê¸€ì„ ë³´ë©´ contextì˜ ë‚´ìš©ì´ keywordë¡œ ì €ì¥ë˜ì–´ìˆë‹¤.

```json
GET /bts_twitter/_mapping/_doc/field/text
```

```json
{
  "bts_twitter" : {
    "mappings" : {
      "_doc" : {
        "text" : {
          "full_name" : "text",
          "mapping" : {
            "text" : {
              "type" : "text",
              "fields" : {
                "keyword" : {
                  "type" : "keyword",
                  "ignore_above" : 256
                }
              }
            }
          }
        }
      }
    }
  }
}
```



**keyword typeê³¼  text type** ì˜ ì°¨ì´ë¥¼ ì•Œì•„ë³´ì

keyword

<https://www.elastic.co/guide/en/elasticsearch/reference/6.7/keyword.html>

text

<https://www.elastic.co/guide/en/elasticsearch/reference/6.7/text.html>

ê°„ë‹¨í•œ ì°¨ì´ë¥¼ ë§í•˜ë©´ text ë¡œ ì €ì¥í•˜ë©´ í•´ë‹¹ í•„ë“œì— ëŒ€í•œ aggregation ë¶„ì„ì„ í• ìˆ˜ ì—†ê³ , keywordëŠ” aggregationì´ ë¶„ì„ì´ ê°€ëŠ¥í•˜ë‹¤.



ê¸°ì¡´ì˜ ë§µí•‘ì„ ì¡°íšŒí•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤. ìƒˆë¡œìš´ ë§µí•‘ì„ ì—…ë°ì´íŠ¸í•´ì£¼ë©´ ê¸°ì¡´ì˜ ê²ƒì˜ ë§µí•‘ ì •ë³´ëŠ” ë³€í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì—, ì§€ìš°ê³  ìƒˆë¡­ê²Œ ë§µí•‘ ì •ë³´ë¥¼ ë„£ì–´ì¤€ë‹¤

```json
"mappings":{  
   "_doc":{  
      "properties":{  
         "post_date":{  
            "type":"date"
         },
         "message":{  
            "type":"text",
            "fields":{  
               "keyword":{  
                  "ignore_above":256,
                  "type":"keyword"
               }
            }
         },
         "user":{  
            "type":"text",
            "fields":{  
               "keyword":{  
                  "ignore_above":256,
                  "type":"keyword"
               }
            }
         }
      }
   }
```

ë³€ê²½í•œ ë§µí•‘ ë‚´ìš©ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

```json
PUT bts_twitter
{
  "mappings": {
    "_doc": {
      "properties": {
        "created_at": {
          "type": "date",
          "format": "EEE MMM dd HH:mm:ss Z yyyy"
        },
        "text":{
          "type": "text"
        }
      }
    }
  }
}
```

ê·¸ë¦¬ê³  ë‹¤ì‹œ ë°ì´í„°ë¥¼ ë„£ì–´ì£¼ëŠ” ë°©ë²•ê³¼ mappingì„ ì—…ë°ì´íŠ¸ í•˜ëŠ” ë°©ë²•ì´ ìˆë‹¤.



### 2. í•„ìš”í•œ ë°ì´í„° ê°€ì§€ê³ ì˜¤ê¸°

ì´ì „ì— ë°ì´í„°ì—ì„œ ë¶ˆí•„ìš”í•œ ì •ë³´ë¥¼ ì œê±°í•œ ì •ë³´ 

```yml
input {
  twitter {
      consumer_key => ""
      consumer_secret => ""
      oauth_token => ""
      oauth_token_secret => ""
      keywords => ["bts"]
      full_tweet => true
  }
}
filter {
  if [lang] != 'ko'{
    drop{}
  }
  mutate{
        remove_field => ["extended_entities","possibly_sensitive","is_quote_status","entities","retweeted_status","in_reply_to_user_id_str","in_reply_to_status_id","in_reply_to_screen_name","in_reply_to_screen_name", "coordinates","contributors","in_reply_to_user_id_str","in_reply_to_status_id","id_str","retweeted_status","geo","reply_count","user","quote_count","in_reply_to_status_id_str","filter_level","possibly_sensitive","retweeted","timestamp_ms","source","truncated","is_quote_status","favorite_count","entities","place","in_reply_to_user_id"]
  }

  date{
    match => ["created_at", "EEE MMM dd HH:mm:ss Z yyyy"]
    timezone => "UTC"
    locale => "ko"
  }

}
output {
   stdout{}
   elasticsearch{
     hosts => "http://127.0.0.1:9200"
     index => "bts_twitter"
     document_type => "_doc"
   }
}
~
"bts_twitter.conf" 33L, 1221C
```

í•„í„°ë§ í•˜ì—¬ ê°€ì§€ê³ ì˜¨ ë°ì´í„°ì˜ ê²°ê³¼ 

```json
"hits" : [
      {
        "_index" : "bts_twitter",
        "_type" : "_doc",
        "_id" : "aBhDYmoB_XnxK7PEt7X1",
        "_score" : null,
        "_source" : {
          "tags" : [
            "_dateparsefailure"
          ],
          "lang" : "ko",
          "id" : 1122361299868868608,
          "text" : """
RT @morethanever_jk: ë°•ìê°ì´ ì•„ì£¼ ì¢‹ì€ í† ë¼ì¼ì„¸..ğŸ° #ì •êµ­ 
#BBMAsTopSocial BTS @BTS_twt https://t.co/BTEtaOLJ5V
""",
          "@timestamp" : "2019-04-28T04:46:01.000Z",
          "favorited" : false,
          "@version" : "1",
          "created_at" : "Sun Apr 28 04:46:01 +0000 2019",
          "retweet_count" : 0
        },
        "sort" : [
          1556426761000
        ]
      }
    ]
```



ì¶”ê°€ë¡œ í•´ì•¼í• ì  : http ì£¼ì†Œë“±ì„ ë‹¤ ì œê±°í•˜ê¸°



ì´ë ‡ê²Œ ë˜ë©´ textëŠ” ì´ì œ analyzerë¥¼ í†µí•´ì„œ ë¬¸ì„œ ì „ì²´ ë°ì´í„°ë¥¼ ê²€ìƒ‰í•˜ê³  ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

<https://www.elastic.co/guide/en/elasticsearch/reference/current/search-analyzer.html>

```json
GET bts_twitter/_doc/_search
{
  "query":{
    "match":{
      "text":{
        "query": "ì •êµ­"
      }
    }
  }
}
```

ê²°ê³¼

```json
"hits" : {
    "total" : 840,
    "max_score" : 3.0186539,
    "hits" : [
      {
        "_index" : "bts_twitter",
        "_type" : "_doc",
        "_id" : "Fhg_YmoB_XnxK7PE2KiQ",
        "_score" : 3.0186539,
        "_source" : {
          "tags" : [
            "_dateparsefailure"
          ],
          "lang" : "ko",
          "id" : 1122360234461122561,
          "text" : """
RT @IDAREU_JK: 190426 ë¯¸í™”ë‹¹ íŒ¬ì‚¬ì¸íšŒ - â¤ï¸â¤ï¸â¤ï¸ BTS ì •êµ­ JUNGKOOK Focus.

4K ğŸ¥ https://t.co/0Hg83W34aB (Full ver.)

#ì •êµ­ #JUNGKOOK #BTSâ  â â @BTS_twt
#Bâ€¦
""",
          "@timestamp" : "2019-04-28T04:41:46.000Z",
          "favorited" : false,
          "@version" : "1",
          "created_at" : "Sun Apr 28 04:41:46 +0000 2019",
          "retweet_count" : 0
        }
      },
      {
        "_index" : "bts_twitter",
        "_type" : "_doc",
        "_id" : "FRhAYmoB_XnxK7PEHqkg",
        "_score" : 3.0186539,
        "_source" : {
          "tags" : [
            "_dateparsefailure"
          ],
          "lang" : "ko",
          "id" : 1122360309782462464,
          "text" : """
RT @IDAREU_JK: 190426 ë¯¸í™”ë‹¹ íŒ¬ì‚¬ì¸íšŒ - â¤ï¸â¤ï¸â¤ï¸ BTS ì •êµ­ JUNGKOOK Focus.

4K ğŸ¥ https://t.co/0Hg83W34aB (Full ver.)

#ì •êµ­ #JUNGKOOK #BTSâ  â â @BTS_twt
#Bâ€¦
""",
          "@timestamp" : "2019-04-28T04:42:04.000Z",
          "favorited" : false,
          "@version" : "1",
          "created_at" : "Sun Apr 28 04:42:04 +0000 2019",
          "retweet_count" : 0
        }
      },
      {
        "_index" : "bts_twitter",
        "_type" : "_doc",
        "_id" : "RRhFYmoB_XnxK7PEbbtA",
        "_score" : 3.0186539,
        "_source" : {
          "tags" : [
            "_dateparsefailure"
          ],
          "lang" : "ko",
          "id" : 1122361769349959681,
          "text" : """
RT @IDAREU_JK: 190426 ë¯¸í™”ë‹¹ íŒ¬ì‚¬ì¸íšŒ - â¤ï¸â¤ï¸â¤ï¸ BTS ì •êµ­ JUNGKOOK Focus.

4K ğŸ¥ https://t.co/0Hg83W34aB (Full ver.)

#ì •êµ­ #JUNGKOOK #BTSâ  â â @BTS_twt
#Bâ€¦
""",
          "@timestamp" : "2019-04-28T04:47:52.000Z",
          "favorited" : false,
          "@version" : "1",
          "created_at" : "Sun Apr 28 04:47:52 +0000 2019",
          "retweet_count" : 0
        }
      },
      {
        "_index" : "bts_twitter",
        "_type" : "_doc",
        "_id" : "GxhHYmoB_XnxK7PEdMLg",
        "_score" : 3.0186539,
        "_source" : {
          "tags" : [
            "_dateparsefailure"
          ],
          "lang" : "ko",
          "id" : 1122362326282190849,
          "text" : """
RT @IDAREU_JK: 190426 ë¯¸í™”ë‹¹ íŒ¬ì‚¬ì¸íšŒ - â¤ï¸â¤ï¸â¤ï¸ BTS ì •êµ­ JUNGKOOK Focus.

4K ğŸ¥ https://t.co/0Hg83W34aB (Full ver.)

#ì •êµ­ #JUNGKOOK #BTSâ  â â @BTS_twt
#Bâ€¦
""",
          "@timestamp" : "2019-04-28T04:50:05.000Z",
          "favorited" : false,
          "@version" : "1",
          "created_at" : "Sun Apr 28 04:50:05 +0000 2019",
          "retweet_count" : 0
        }
      },
      {
        "_index" : "bts_twitter",
        "_type" : "_doc",
        "_id" : "gBhHYmoB_XnxK7PEScHj",
        "_score" : 2.9561784,
        "_source" : {
          "tags" : [
            "_dateparsefailure"
          ],
          "lang" : "ko",
          "id" : 1122362280593645568,
          "text" : """
ä¸­ ì›¨ì´ë³´ 'ë°©íƒ„ì†Œë…„ë‹¨ ì •êµ­' ì§ìº  3ì‹œê°„ë§Œì— 105ë§Œ ëŒíŒŒ! "ëŒ€ë¥™ ë’¤í”ë“¤ë‹¤"
#ì •êµ­ #ì „ì •êµ­ #jungkook #BTS @BTS_twt https://t.co/7sLJsJtnHG
""",
          "@timestamp" : "2019-04-28T04:49:54.000Z",
          "favorited" : false,
          "@version" : "1",
          "created_at" : "Sun Apr 28 04:49:54 +0000 2019",
          "retweet_count" : 0
        }
      }
    ]
```



ë‹¤ìŒì—ëŠ” norië¥¼ ì ìš©í•´ë³´ì http://ë¥¼ ì œê±°ë¥¼ í•´ì•¼í•˜ì§€ë§Œ ë¨¼ì € í•˜ê³ ì‹¶ì–´ì„œ ì¼ë‹¨ ì‹œì‘





ë²ˆì™¸

retweetì´ 0 ì´ ì•„ë‹Œê²ƒì„ ì°¾ì•˜ëŠ”ë° ì „ë¶€ ã… ã…  ì—†ë‹¤ë¼ê³  ë‚˜ì˜¤ë„¤

```json
GET bts_twitter/_search
{
  "query": {
    "bool": {
      "must_not": [
        {
          "match": {
            "retweet_count": 0
          }
        }
      ]
    }
  }
}
```

